# DDL: CREATE and ALTER Statements

## Overview

Data Definition Language (DDL) statements define and modify database structure. This guide covers CREATE and ALTER commands for creating and modifying tables using Oracle SQL.

## CREATE TABLE

The `CREATE TABLE` statement creates a new table in the database.

### Basic Syntax

```sql
CREATE TABLE table_name (
    column1 datatype constraints,
    column2 datatype constraints,
    ...
    table_constraints
);
```

### Example 1: Simple Table with Primary Key

**SQL Statement:**

```sql
CREATE TABLE students (
    student_id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    first_name VARCHAR2(50) NOT NULL,
    last_name VARCHAR2(50) NOT NULL,
    email VARCHAR2(100) UNIQUE,
    enrollment_date DATE DEFAULT SYSDATE
);
```

**Table Structure Created:**

| Column          | Type          | Constraints          |
| --------------- | ------------- | -------------------- |
| student_id      | INTEGER       | GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY |
| first_name      | VARCHAR2(50)  | NOT NULL             |
| last_name       | VARCHAR2(50)  | NOT NULL             |
| email           | VARCHAR2(100) | UNIQUE               |
| enrollment_date | DATE          | DEFAULT SYSDATE      |

<details>
<summary>Auto-increment Implementation in Oracle</summary>

Oracle 12c and later supports identity columns with `GENERATED BY DEFAULT AS IDENTITY` or `GENERATED ALWAYS AS IDENTITY`. The `BY DEFAULT` variant allows manual insertion of values, while `ALWAYS` prevents it.

For Oracle 11g and earlier, use sequences:
```sql
CREATE SEQUENCE student_seq START WITH 1 INCREMENT BY 1;

CREATE TABLE students (
    student_id INTEGER PRIMARY KEY,
    ...
);

-- Insert using sequence
INSERT INTO students (student_id, first_name, last_name)
VALUES (student_seq.NEXTVAL, 'John', 'Doe');
```

</details>

### Example 2: Table with Foreign Key

**SQL Statement:**

```sql
CREATE TABLE courses (
    course_id VARCHAR2(10) PRIMARY KEY,
    course_name VARCHAR2(100) NOT NULL,
    credits INTEGER CHECK (credits > 0 AND credits <= 6),
    department VARCHAR2(50) NOT NULL,
    instructor_id INTEGER,
    FOREIGN KEY (instructor_id) REFERENCES instructors(instructor_id)
);
```

**Table Structure Created:**

| Column        | Type          | Constraints                               |
| ------------- | ------------- | ----------------------------------------- |
| course_id     | VARCHAR2(10)  | PRIMARY KEY                               |
| course_name   | VARCHAR2(100) | NOT NULL                                  |
| credits       | INTEGER       | CHECK (credits > 0 AND credits <= 6)      |
| department    | VARCHAR2(50)  | NOT NULL                                  |
| instructor_id | INTEGER       | FOREIGN KEY â†’ instructors(instructor_id) |

### Example 3: Junction Table with Composite Primary Key

**SQL Statement:**

```sql
CREATE TABLE enrollments (
    student_id INTEGER,
    course_id VARCHAR2(10),
    semester VARCHAR2(20),
    grade VARCHAR2(2),
    enrollment_date DATE DEFAULT SYSDATE,
    PRIMARY KEY (student_id, course_id, semester),
    FOREIGN KEY (student_id) REFERENCES students(student_id),
    FOREIGN KEY (course_id) REFERENCES courses(course_id)
);
```

**Table Structure Created:**

| Column          | Type         | Constraints                      |
| --------------- | ------------ | -------------------------------- |
| student_id      | INTEGER      | Part of PRIMARY KEY, FOREIGN KEY |
| course_id       | VARCHAR2(10) | Part of PRIMARY KEY, FOREIGN KEY |
| semester        | VARCHAR2(20) | Part of PRIMARY KEY              |
| grade           | VARCHAR2(2)  |                                  |
| enrollment_date | DATE         | DEFAULT SYSDATE                  |

## Oracle Data Types

### Common Data Types

| Category  | Type          | Description                     | Example               |
| --------- | ------------- | ------------------------------- | --------------------- |
|           |               |                                 |                       |
| Integer   | INTEGER       | Alias for NUMBER(38)            | 42                    |
| Integer   | NUMBER(p)     | Integer with precision          | NUMBER(10)            |
| Integer   | NUMBER(p,0)   | Integer with precision          | NUMBER(10,0)          |
| Decimal   | NUMBER(p,s)   | Exact decimal                   | NUMBER(10,2)          |
| String    | VARCHAR2(n)   | Variable-length string          | 'Hello'               |
| String    | CHAR(n)       | Fixed-length string             | 'ABC'                 |
| String    | CLOB          | Large text objects              | Long text             |
| Date/Time | DATE          | Date and time                   | '15-JAN-2024'         |
| Date/Time | TIMESTAMP     | Date and time with precision    | TIMESTAMP '2024-01-15 10:30:00' |
| Binary    | BLOB          | Binary large objects            | Images, files         |

### Constraints

| Constraint  | Purpose                        | Example                                 |
| ----------- | ------------------------------ | --------------------------------------- |
| PRIMARY KEY | Uniquely identifies each row   | PRIMARY KEY                             |
| FOREIGN KEY | References another table       | FOREIGN KEY (col) REFERENCES table(col) |
| NOT NULL    | Column cannot be NULL          | NOT NULL                                |
| UNIQUE      | All values must be different   | UNIQUE                                  |
| CHECK       | Custom validation              | CHECK (age >= 18)                       |
| DEFAULT     | Default value if none provided | DEFAULT 0                               |

## ALTER TABLE

The `ALTER TABLE` statement modifies an existing table's structure.

### Sample Data for ALTER Examples

First, let's create and populate a sample table:

```sql
CREATE TABLE products (
    product_id INTEGER PRIMARY KEY,
    product_name VARCHAR2(100) NOT NULL,
    price NUMBER(10, 2)
);

INSERT INTO products (product_id, product_name, price) VALUES
(1, 'Laptop', 999.99);
INSERT INTO products (product_id, product_name, price) VALUES
(2, 'Mouse', 25.50);
INSERT INTO products (product_id, product_name, price) VALUES
(3, 'Keyboard', 75.00);
```

**Current Products Table:**

| product_id | product_name | price  |
| ---------- | ------------ | ------ |
| 1          | Laptop       | 999.99 |
| 2          | Mouse        | 25.50  |
| 3          | Keyboard     | 75.00  |

### ALTER: Adding a Column

**SQL Statement:**

```sql
ALTER TABLE products 
ADD stock_quantity INTEGER DEFAULT 0;
```

**Result - Updated Table Structure:**

| product_id | product_name | price  | stock_quantity |
| ---------- | ------------ | ------ | -------------- |
| 1          | Laptop       | 999.99 | 0              |
| 2          | Mouse        | 25.50  | 0              |
| 3          | Keyboard     | 75.00  | 0              |

### ALTER: Modifying Column Data Type

**SQL Statement:**

```sql
ALTER TABLE products 
MODIFY price NUMBER(12, 2);
```

**Effect:** Changes the price column from NUMBER(10,2) to NUMBER(12,2), allowing larger values.

### ALTER: Adding NOT NULL Constraint

**SQL Statement:**

```sql
-- First, ensure no NULL values exist
UPDATE products SET stock_quantity = 0 WHERE stock_quantity IS NULL;

-- Then add NOT NULL constraint
ALTER TABLE products 
MODIFY stock_quantity INTEGER NOT NULL;
```

**Effect:** The stock_quantity column now requires a value (cannot be NULL).

### ALTER: Dropping a Column

**SQL Statement:**

```sql
ALTER TABLE products 
DROP COLUMN stock_quantity;
```

**Result - Updated Table:**

| product_id | product_name | price  |
| ---------- | ------------ | ------ |
| 1          | Laptop       | 999.99 |
| 2          | Mouse        | 25.50  |
| 3          | Keyboard     | 75.00  |

### ALTER: Adding Constraints

**Example 1: Add UNIQUE constraint**

```sql
ALTER TABLE products 
ADD CONSTRAINT unique_product_name UNIQUE (product_name);
```

**Example 2: Add CHECK constraint**

```sql
ALTER TABLE products 
ADD CONSTRAINT check_positive_price CHECK (price > 0);
```

**Example 3: Add Foreign Key**

```sql
-- Assuming we have a categories table
ALTER TABLE products 
ADD category_id INTEGER 
    CONSTRAINT fk_category REFERENCES categories(category_id);
```

### ALTER: Dropping Constraints

**SQL Statement:**

```sql
ALTER TABLE products 
DROP CONSTRAINT check_positive_price;
```

**Effect:** Removes the price validation constraint.

### ALTER: Renaming Column

**SQL Statement:**

```sql
ALTER TABLE products 
RENAME COLUMN product_name TO name;
```

**Result - Updated Table:**

| product_id | name     | price  |
| ---------- | -------- | ------ |
| 1          | Laptop   | 999.99 |
| 2          | Mouse    | 25.50  |
| 3          | Keyboard | 75.00  |

### ALTER: Renaming Table

**SQL Statement:**

```sql
RENAME products TO inventory;
```

**Effect:** The table is now named `inventory` instead of `products`.

## Complete Example: Building a Related Schema

### Step 1: Create Departments Table

```sql
CREATE TABLE departments (
    dept_id INTEGER PRIMARY KEY,
    dept_name VARCHAR2(50) NOT NULL UNIQUE,
    building VARCHAR2(50)
);

INSERT INTO departments (dept_id, dept_name, building) VALUES
(1, 'Computer Science', 'Science Hall');
INSERT INTO departments (dept_id, dept_name, building) VALUES
(2, 'Mathematics', 'Math Building');
INSERT INTO departments (dept_id, dept_name, building) VALUES
(3, 'Physics', 'Science Hall');
```

**Departments Table:**

| dept_id | dept_name        | building      |
| ------- | ---------------- | ------------- |
| 1       | Computer Science | Science Hall  |
| 2       | Mathematics      | Math Building |
| 3       | Physics          | Science Hall  |

### Step 2: Create Instructors Table

```sql
CREATE TABLE instructors (
    instructor_id INTEGER PRIMARY KEY,
    instructor_name VARCHAR2(100) NOT NULL,
    dept_id INTEGER,
    hire_date DATE,
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
);

INSERT INTO instructors (instructor_id, instructor_name, dept_id, hire_date) VALUES
(1, 'Dr. Johnson', 1, DATE '2018-08-15');
INSERT INTO instructors (instructor_id, instructor_name, dept_id, hire_date) VALUES
(2, 'Dr. Lee', 2, DATE '2019-01-10');
INSERT INTO instructors (instructor_id, instructor_name, dept_id, hire_date) VALUES
(3, 'Dr. Martinez', 3, DATE '2020-09-01');
```

**Instructors Table:**

| instructor_id | instructor_name | dept_id | hire_date  |
| ------------- | --------------- | ------- | ---------- |
| 1             | Dr. Johnson     | 1       | 2018-08-15 |
| 2             | Dr. Lee         | 2       | 2019-01-10 |
| 3             | Dr. Martinez    | 3       | 2020-09-01 |

### Step 3: Add Department Column to Existing Courses Table

```sql
ALTER TABLE courses 
ADD dept_id INTEGER 
    CONSTRAINT fk_courses_dept REFERENCES departments(dept_id);
```
